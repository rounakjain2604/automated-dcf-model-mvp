<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DCF Investment Portal</title>
    <style>
      :root {
        --navy: #0f243e;
        --blue: #1f4e78;
        --dark: #2f2f2f;
        --muted: #5a6473;
        --bg: #f4f6fa;
        --card: #ffffff;
        --line: #e3e8f0;
        --soft: #eef4ff;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: "Segoe UI", Arial, sans-serif;
        background: var(--bg);
        color: var(--dark);
      }
      .wrap { max-width: 1180px; margin: 26px auto; padding: 0 16px; }
      .hero {
        background: linear-gradient(135deg, #0f243e 0%, #1f4e78 100%);
        color: white;
        border-radius: 14px;
        padding: 18px 22px;
        box-shadow: 0 8px 24px rgba(15, 36, 62, 0.18);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 14px;
      }
      .hero h1 { margin: 0 0 6px; font-size: 26px; }
      .hero p { margin: 0; color: #deebff; }
      .hero-actions { display: flex; gap: 8px; flex-wrap: wrap; }
      .hero-btn {
        display: inline-block;
        text-decoration: none;
        padding: 9px 12px;
        border-radius: 9px;
        font-size: 13px;
        font-weight: 700;
        border: 1px solid rgba(255,255,255,0.4);
        color: #fff;
      }
      .hero-btn.alt { background: rgba(255,255,255,0.15); }
      .grid {
        margin-top: 16px;
        display: grid;
        grid-template-columns: 1.2fr 1fr;
        gap: 16px;
      }
      .card {
        background: var(--card);
        border: 1px solid var(--line);
        border-radius: 12px;
        padding: 16px;
      }
      .card h2 { margin: 0 0 14px; color: var(--navy); font-size: 18px; }
      .subhead {
        margin: 0 0 10px;
        padding: 8px 10px;
        border-radius: 8px;
        background: var(--soft);
        color: var(--blue);
        font-weight: 700;
        font-size: 13px;
      }
      .field { margin-bottom: 12px; }
      label { display: block; margin-bottom: 6px; font-size: 13px; color: var(--muted); }
      input, select {
        width: 100%;
        border: 1px solid #cfd8e6;
        border-radius: 8px;
        padding: 10px 11px;
        font-size: 14px;
        background: #fff;
      }
      .hint { font-size: 12px; color: #7a8496; margin-top: 4px; }
      .cta {
        margin-top: 14px;
        width: 100%;
        padding: 12px;
        border: 0;
        border-radius: 10px;
        background: #1f4e78;
        color: white;
        font-weight: 700;
        cursor: pointer;
      }
      .cta:hover { filter: brightness(1.05); }
      .footer {
        margin-top: 14px;
        font-size: 12px;
        color: #7a8496;
      }
      .mini-grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 10px;
      }
      .mini-card {
        border: 1px solid var(--line);
        border-radius: 9px;
        padding: 10px;
        background: #fafcff;
      }
      .mini-card h3 {
        margin: 0 0 6px;
        color: var(--blue);
        font-size: 13px;
      }
      .mini-card ul {
        margin: 0;
        padding-left: 16px;
        font-size: 12px;
        color: #556074;
      }
      .mini-card li { margin: 4px 0; }
      .warn {
        margin-top: 12px;
        padding: 10px 12px;
        border-radius: 8px;
        border: 1px solid #f1c27d;
        background: #fff7e8;
        color: #6f4f1f;
        font-size: 13px;
        display: none;
      }
      .preview {
        margin-top: 12px;
        border: 1px solid var(--line);
        border-radius: 10px;
        background: #f9fbff;
        overflow: hidden;
      }
      .preview-head {
        background: #eef4ff;
        padding: 10px 12px;
        font-size: 13px;
        color: var(--navy);
        font-weight: 700;
      }
      .preview-grid {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 8px 10px;
        padding: 10px 12px;
        font-size: 12px;
      }
      .preview-grid div:nth-child(odd) { color: #52607a; }
      .preview-grid div:nth-child(even) { color: #1f2f47; font-weight: 600; }
      @media (max-width: 980px) {
        .grid { grid-template-columns: 1fr; }
        .hero { flex-direction: column; align-items: flex-start; }
      }
      @media (max-width: 620px) { .mini-grid { grid-template-columns: 1fr; } }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="hero">
        <div>
          <h1>DCF Investment Workbench</h1>
          <p>Structured assumptions, model quality controls, and one-click output pack (Excel + Word).</p>
        </div>
        <div class="hero-actions">
          <a class="hero-btn" href="/guide">Non-Finance Guide</a>
          <a class="hero-btn alt" href="#generatorForm">Go to Inputs</a>
        </div>
      </div>

      <div id="runWarning" class="warn"></div>

      <form id="generatorForm" action="/generate" method="post" enctype="multipart/form-data" class="grid">
        <div class="card">
          <h2>Workflow & Inputs</h2>
          <div class="subhead">Step 1 — Company and source data</div>
          <div class="field">
            <label>Company Name</label>
            <input name="company_name" value="Insurance Agency" required />
          </div>
          <div class="field">
            <label>Financial File (.csv/.xlsx) - Optional</label>
            <input type="file" name="financial_file" accept=".csv,.xlsx,.xls" />
            <div class="hint">If no file is uploaded, quick-input values below create a synthetic input set.</div>
          </div>
          <div class="field">
            <label>Logo (for Word report header) - Optional</label>
            <input type="file" name="logo_file" accept=".png,.jpg,.jpeg" />
          </div>
          <div class="field">
            <label>Scenario</label>
            <select name="scenario" id="scenarioSelect">
              <option>Base</option>
              <option>Bull</option>
              <option>Bear</option>
            </select>
          </div>

          <div class="subhead">Step 2 — Forecast and valuation assumptions</div>
          <div class="mini-grid">
            <div class="mini-card">
              <h3>Operating Drivers</h3>
              <ul>
                <li>Revenue, EBITDA/SDE, Growth</li>
                <li>COGS %, Opex %, Capex %</li>
                <li>Tax rate and working assumptions</li>
              </ul>
            </div>
            <div class="mini-card">
              <h3>Risk & Valuation</h3>
              <ul>
                <li>WACC, Terminal growth</li>
                <li>Risk-free rate, beta, size premium</li>
                <li>Cash, debt, and ask/current level</li>
              </ul>
            </div>
          </div>

          <div class="subhead">Scenario Defaults Preview</div>

          <div class="preview">
            <div class="preview-head">Blank fields use these defaults</div>
            <div class="preview-grid" id="defaultsPreview"></div>
          </div>

          <div class="subhead" style="margin-top:12px;">Model Quality Controls</div>
          <div class="mini-card">
            <ul>
              <li>Terminal growth capped against long-run GDP assumptions.</li>
              <li>Minimum spread enforced between WACC and terminal growth.</li>
              <li>Blended terminal valuation (Gordon + Exit) for balanced output.</li>
              <li>Checks sheet flags potential integrity and sensitivity risks.</li>
            </ul>
          </div>
        </div>

        <div class="card">
          <h2>Quick Input Panel</h2>
          <div class="field">
            <label>Revenue ($)</label>
             <input name="revenue" type="number" step="0.01" placeholder="Leave blank to use scenario default" />
          </div>
          <div class="field">
            <label>EBITDA / SDE ($)</label>
             <input name="ebitda" type="number" step="0.01" placeholder="Leave blank to use scenario default" />
          </div>
          <div class="field">
            <label>Growth Rate (%)</label>
             <input name="growth_rate" type="number" step="0.01" placeholder="Leave blank to use scenario default" />
          </div>
          <div class="field">
            <label>WACC / Discount Rate (%)</label>
            <input name="wacc" type="number" step="0.01" placeholder="Leave blank to use scenario default" />
          </div>
          <div class="field">
            <label>Terminal Growth Rate (%)</label>
            <input name="terminal_growth" type="number" step="0.01" placeholder="Leave blank to use scenario default" />
          </div>
          <div class="field">
            <label>Cash ($)</label>
            <input name="cash" type="number" step="0.01" placeholder="Leave blank to use scenario default" />
          </div>
          <div class="field">
            <label>Debt ($)</label>
            <input name="debt" type="number" step="0.01" placeholder="Leave blank to use scenario default" />
          </div>
          <div class="field">
            <label>Ask Price ($)</label>
            <input name="ask_price" type="number" step="0.01" placeholder="Leave blank to use scenario default" />
          </div>
          <div class="field">
            <label>COGS % of Revenue</label>
            <input name="cogs_pct" type="number" step="0.01" placeholder="Leave blank to use scenario default" />
          </div>
          <div class="field">
            <label>Opex % of Revenue</label>
            <input name="opex_pct" type="number" step="0.01" placeholder="Leave blank to use scenario default" />
          </div>
          <div class="field">
            <label>Capex % of Revenue</label>
            <input name="capex_pct" type="number" step="0.01" placeholder="Leave blank to use scenario default" />
          </div>
          <div class="field">
            <label>Tax Rate (%)</label>
            <input name="tax_rate" type="number" step="0.01" placeholder="Leave blank to use scenario default" />
          </div>
          <div class="field">
            <label>Risk-Free Rate (%)</label>
            <input name="risk_free_rate" type="number" step="0.01" placeholder="Leave blank to use scenario default" />
          </div>
          <div class="field">
            <label>Beta</label>
            <input name="beta" type="number" step="0.01" placeholder="Leave blank to use scenario default" />
          </div>
          <div class="field">
            <label>Size Premium (%)</label>
            <input name="size_premium" type="number" step="0.01" placeholder="Leave blank to use scenario default" />
          </div>
          <button class="cta" type="submit">Generate Valuation Files</button>
          <div class="footer">Blank fields use scenario defaults. Filled fields override defaults. Output ZIP includes a structured Excel model and Word memo.</div>
        </div>
      </form>
    </div>

    <script>
      (function () {
        var CASE_DEFAULTS = {{ case_defaults|tojson }};
        var form = document.getElementById("generatorForm");
        var warning = document.getElementById("runWarning");
        var scenarioSelect = document.getElementById("scenarioSelect");
        var preview = document.getElementById("defaultsPreview");

        function fmtMoney(v) {
          return new Intl.NumberFormat("en-US", { style: "currency", currency: "USD", maximumFractionDigits: 0 }).format(v);
        }

        function fmtPct(v) {
          return v.toFixed(2) + "%";
        }

        function renderPreview() {
          var key = scenarioSelect.value;
          var d = CASE_DEFAULTS[key] || CASE_DEFAULTS.Base;
          preview.innerHTML = "";

          var items = [
            ["Revenue", fmtMoney(d.revenue)],
            ["EBITDA / SDE", fmtMoney(d.ebitda)],
            ["Growth Rate", fmtPct(d.growth_rate)],
            ["WACC", fmtPct(d.wacc)],
            ["Terminal Growth", fmtPct(d.terminal_growth)],
            ["COGS %", fmtPct(d.cogs_pct)],
            ["Opex %", fmtPct(d.opex_pct)],
            ["Capex %", fmtPct(d.capex_pct)],
            ["Tax Rate", fmtPct(d.tax_rate)],
            ["Risk-Free Rate", fmtPct(d.risk_free_rate)],
            ["Beta", d.beta.toFixed(2)],
            ["Size Premium", fmtPct(d.size_premium)],
            ["Cash", fmtMoney(d.cash)],
            ["Debt", fmtMoney(d.debt)],
            ["Ask Price", fmtMoney(d.ask_price)]
          ];

          items.forEach(function (row) {
            var l = document.createElement("div");
            var v = document.createElement("div");
            l.textContent = row[0];
            v.textContent = row[1];
            preview.appendChild(l);
            preview.appendChild(v);
          });
        }

        if (window.location.protocol === "file:") {
          form.action = "http://127.0.0.1:5000/generate";
          warning.style.display = "block";
          warning.textContent = "You opened this HTML file directly. Start the Flask app (python webapp.py) and open http://127.0.0.1:5000 for full functionality.";
        }

        scenarioSelect.addEventListener("change", renderPreview);
        renderPreview();
      })();
    </script>
  </body>
</html>
